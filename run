#!/usr/bin/env gosh
(use srfi-13)
(load "./compiler.scm")
(define (main args)
  (let ([proc (lambda (port)
                (let ([line (read-line port)])
                  (if (and (not (eof-object? line)) (string-prefix? ";directive " line))
                      (set! *directive* (string-copy line (string-length ";directive ")))))
                (port-seek port 0)
                (port->sexp-list port))])
    (build-program `(begin ,@(call-with-input-file (cadr args) proc)))
    (sys-system "./a.out")))
